<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Day-of-Week Trainer</title>
  <!-- Tailwind for styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: linear-gradient(180deg,#0b0714,#140b22); }
    .card { background: rgba(26,15,43,.85); border: 1px solid rgba(120,53,175,.45); }
    .panel { background: rgba(88,28,135,.25); border: 1px solid rgba(120,53,175,.45); }
    #errors { display:none; white-space:pre-wrap; background:#2b0f3a; border:1px solid #7e22ce; color:#fca5a5;
              padding:.75rem; border-radius:.75rem; margin-top:1rem; font-family:ui-monospace, SFMono-Regular, Menlo, monospace;}
  </style>
</head>
<body class="text-purple-50">
  <div id="root" class="min-h-screen w-full">Loading UI…</div>
  <pre id="errors"></pre>

  <!-- React + Babel (compile JSX in the browser) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel" data-presets="env,react">
    const { useEffect, useMemo, useRef, useState } = React;

    const MONTH_NAMES=["January","February","March","April","May","June","July","August","September","October","November","December"];
    const DAY_NAMES=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

    // Calendar helpers (proleptic Gregorian; astronomical year internally)
    const toAstro = y => y>0 ? y : 1-Math.abs(y);                 // 1 BC -> 0, 2 BC -> -1, ...
    const isLeap  = y => (y%400===0)||((y%4===0)&&(y%100!==0));
    function daysInMonthDisplay(yDisplay,m){
      const y=toAstro(yDisplay);
      if(m===2) return isLeap(y)?29:28;
      return [4,6,9,11].includes(m)?30:31;
    }
    function jdnGregorian(y,m,d){
      const a=Math.floor((14-m)/12);
      const y2=y+4800-a;
      const m2=m+12*a-3;
      return d+Math.floor((153*m2+2)/5)+365*y2+Math.floor(y2/4)-Math.floor(y2/100)+Math.floor(y2/400)-32045;
    }
    const weekdaySunday0=(yDisplay,m,d)=>(jdnGregorian(toAstro(yDisplay),m,d)+1)%7;
    const fmtDate=(y,m,d)=>`${MONTH_NAMES[m-1]} ${d} ${y>0?y:Math.abs(y)+' BC'}`;

    // Random date in range (skip year 0)
    const rnd=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;
    function randomValidDate(minYear,maxYear){
      let y; do { y=rnd(minYear,maxYear);} while(y===0);
      const m=rnd(1,12), d=rnd(1,daysInMonthDisplay(y,m));
      return {y,m,d};
    }

    // Parse input
    const DAY_ALIASES={sun:0,sunday:0,mon:1,monday:1,tue:2,tues:2,tuesday:2,wed:3,weds:3,wednesday:3,thu:4,thur:4,thurs:4,thursday:4,fri:5,friday:5,sat:6,saturday:6};
    function parseAnswer(text){
      const s=text.trim(), low=s.toLowerCase();
      if(!s) return {kind:"invalid",payload:s};
      if(low==="stop") return {kind:"cmd",payload:"stop"};
      if(low==="help") return {kind:"cmd",payload:"help"};
      if(/^\d$/.test(s)){const n=+s;return (n>=0&&n<=6)?{kind:"ok",payload:n}:{kind:"invalid",payload:s};}
      if(low in DAY_ALIASES) return {kind:"ok",payload:DAY_ALIASES[low]};
      return {kind:"invalid",payload:s};
    }

    function Stat({label,value}) {
      return (
        <div className="px-4 py-3 rounded-2xl panel text-center">
          <div className="text-sm text-purple-200/80">{label}</div>
          <div className="text-xl font-semibold text-purple-100 tabular-nums">{value}</div>
        </div>
      );
    }

    function App(){
      // Settings
      const [mode,setMode]=useState("classic");          // classic | survival | timed
      const [includeBC,setIncludeBC]=useState(false);    // toggle to allow BC
      const sliderMin=includeBC?-10000:1;
      const sliderMax=10000;
      const [minYear,setMinYear]=useState(1900);
      const [maxYear,setMaxYear]=useState(2100);

      // Game state
      const [date,setDate]=useState(()=>randomValidDate(minYear,maxYear));
      const correctIdx=useMemo(()=>weekdaySunday0(date.y,date.m,date.d),[date]);
      const [input,setInput]=useState("");
      const [message,setMessage]=useState("");
      const [guesses,setGuesses]=useState([]);
      const [roundFlawless,setRoundFlawless]=useState(true);

      const [played,setPlayed]=useState(0);
      const [correct,setCorrect]=useState(0);
      const [streak,setStreak]=useState(0);
      const [best,setBest]=useState(0);

      // Timed mode
      const [seconds,setSeconds]=useState(60);
      const [timerRunning,setTimerRunning]=useState(false);

      const inputRef=useRef(null);
      useEffect(()=>{inputRef.current?.focus();},[date]);
      useEffect(()=>{
        if(mode!=="timed"||!timerRunning||seconds<=0) return;
        const t=setTimeout(()=>setSeconds(s=>s-1),1000);
        return ()=>clearTimeout(t);
      },[mode,timerRunning,seconds]);
      useEffect(()=>{
        if(mode==="timed"&&seconds===0){setTimerRunning(false);setMessage("Time! Session ended.");}
      },[mode,seconds]);

      function clampYears(lo,hi){
        let a=Math.max(sliderMin,Math.min(lo,sliderMax));
        let b=Math.max(sliderMin,Math.min(hi,sliderMax));
        if(!includeBC){a=Math.max(1,a);b=Math.max(1,b);}
        if(a===0) a=1; if(b===0) b=1;
        if(a>b)[a,b]=[b,a];
        setMinYear(a); setMaxYear(b);
      }
      function resetRound(){
        setGuesses([]); setRoundFlawless(true); setInput("");
        setDate(randomValidDate(minYear,maxYear)); setMessage("");
      }
      function sessionSummary(){
        const pct=played?(correct/played*100).toFixed(1):"0.0";
        return `Score: ${correct}/${played} (${pct}% correct) — Longest streak: ${best}`;
      }

      function submit(text){
        const {kind,payload}=parseAnswer(text);

        if(kind==="cmd"&&payload==="stop"){setMessage(sessionSummary()); setTimerRunning(false); return;}
        if(kind==="cmd"&&payload==="help"){
          setMessage(`Answer: ${DAY_NAMES[correctIdx]}.`);
          setPlayed(p=>p+1); setStreak(0);
          if(mode==="survival"){ setMessage(m=>m+" Game over."); return; }
          resetRound(); return;
        }
        if(kind==="invalid"){ setMessage("Invalid input. Type a day or 0–6. Use 'help' or 'stop'."); return; }

        if(payload===correctIdx){
          if(roundFlawless){
            setMessage("Correct ✔");
            setPlayed(p=>p+1); setCorrect(c=>c+1);
            setStreak(s=>{const ns=s+1; if(ns>best) setBest(ns); return ns;});
            resetRound();
          }else{
            setMessage("Correct — but this round is scored incorrect due to an earlier miss.");
            setPlayed(p=>p+1); setStreak(0);
            if(mode==="survival"){ setMessage(m=>m+" Game over."); return; }
            resetRound();
          }
        }else{
          setRoundFlawless(false);
          const label=DAY_NAMES[payload];
          setMessage("Incorrect ✖");
          setGuesses(g=>g.includes(label)?g:[...g,label]);
          if(mode==="survival"){
            setPlayed(p=>p+1); setStreak(0);
            setMessage(m=>`${m} Answer: ${DAY_NAMES[correctIdx]}. Game over.`);
          }
        }
      }

      function clickDay(i){
        if(mode==="timed"&&!timerRunning&&seconds>0) setTimerRunning(true);
        submit(String(i)); setInput(""); inputRef.current?.focus();
      }
      function handleForm(e){
        e.preventDefault();
        if(mode==="timed"&&!timerRunning&&seconds>0) setTimerRunning(true);
        submit(input); setInput(""); inputRef.current?.focus();
      }

      return (
        <div className="max-w-4xl mx-auto px-4 py-8">
          {/* Header */}
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <h1 className="text-2xl font-semibold tracking-tight">Day-of-Week Trainer</h1>
              <span className="px-3 py-1 rounded-full text-xs font-medium bg-purple-600 text-white">Dark Purple</span>
            </div>
            <div className="flex items-center gap-3">
              <select value={mode} onChange={e=>{setMode(e.target.value); setMessage(""); setStreak(0); setSeconds(60); setTimerRunning(false);}}
                className="panel rounded-xl px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-400">
                <option value="classic">Classic</option>
                <option value="survival">Survival</option>
                <option value="timed">Timed (60s)</option>
              </select>
              <label className="flex items-center gap-2 cursor-pointer select-none">
                <input type="checkbox" className="sr-only" checked={includeBC}
                  onChange={e=>{setIncludeBC(e.target.checked); clampYears(e.target.checked?Math.min(-100,minYear):Math.max(1,minYear), Math.max(100,maxYear));}}/>
                <span className={"w-11 h-6 rounded-full relative "+(includeBC?"bg-purple-500":"bg-zinc-600")}>
                  <span className={"absolute top-0.5 left-0.5 w-5 h-5 rounded-full bg-white transition-transform "+(includeBC?"translate-x-6":"")}></span>
                </span>
                <span className="text-sm text-purple-100/90">Include BC (Hard Mode)</span>
              </label>
            </div>
          </div>

          {/* Settings */}
          <div className="mt-5 grid grid-cols-1 md:grid-cols-3 gap-4">
            <div className="md:col-span-2 p-4 rounded-2xl panel">
              <div className="flex items-center justify-between mb-2">
                <span className="text-sm text-purple-200/80">Year range</span>
                <div className="text-sm tabular-nums text-purple-200">{minYear} → {maxYear}</div>
              </div>
              <div className="flex items-center gap-4">
                <input type="range" min={sliderMin} max="10000" step="1" value={minYear}
                  onChange={e=>clampYears(+e.target.value, maxYear)} className="w-full accent-purple-500"/>
                <input type="range" min={sliderMin} max="10000" step="1" value={maxYear}
                  onChange={e=>clampYears(minYear, +e.target.value)} className="w-full accent-purple-500"/>
              </div>
              <div className="mt-3 grid grid-cols-2 gap-3">
                <input type="number" className="panel rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-400"
                  value={minYear} onChange={e=>clampYears(+e.target.value, maxYear)}/>
                <input type="number" className="panel rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-400"
                  value={maxYear} onChange={e=>clampYears(minYear, +e.target.value)}/>
              </div>
              <p className="mt-2 text-xs text-purple-300/70">Uses the proleptic Gregorian calendar. Year 0 isn’t shown (1 BC ↔ year 0 internally).</p>
            </div>

            <div className="grid grid-cols-2 gap-3">
              <Stat label="Score"    value={`${correct}/${played}`}/>
              <Stat label="Accuracy" value={`${played ? (correct/played*100).toFixed(1) : "0.0"}%`}/>
              <Stat label="Streak"   value={streak}/>
              <Stat label="Longest"  value={best}/>
              {mode==="timed" && (
                <div className="col-span-2 px-4 py-3 rounded-2xl panel flex items-center justify-between">
                  <div className="text-sm text-purple-200/80">Time left</div>
                  <div className="text-xl font-semibold tabular-nums">{seconds}s</div>
                </div>
              )}
            </div>
          </div>

          {/* Prompt Card */}
          <div className="mt-8 p-6 rounded-3xl card shadow-xl">
            <div className="text-center">
              <div className="text-sm uppercase tracking-widest text-purple-300/70">What day is this?</div>
              <div className="mt-2 text-4xl md:text-5xl font-bold">{fmtDate(date.y,date.m,date.d)}</div>
            </div>

            {/* Buttons */}
            <div className="mt-6 grid grid-cols-2 sm:grid-cols-4 md:grid-cols-7 gap-2">
              {DAY_NAMES.map((n,i)=>(
                <button key={n} onClick={()=>{ if(mode==="timed"&&!timerRunning&&seconds>0) setTimerRunning(true);
                  submit(String(i)); setInput(""); inputRef.current?.focus(); }}
                  className="w-full rounded-xl border border-purple-800/60 bg-purple-900/30 hover:bg-purple-900/50 px-3 py-2 text-sm">
                  {n}
                </button>
              ))}
            </div>

            {/* Input Row */}
            <form onSubmit={(e)=>{e.preventDefault(); if(mode==="timed"&&!timerRunning&&seconds>0) setTimerRunning(true);
                    submit(input); setInput(""); inputRef.current?.focus();}} className="mt-4 flex gap-2">
              <input ref={inputRef} value={input} onChange={e=>setInput(e.target.value)}
                     placeholder="Type a day (e.g., Monday) or 0–6. Use 'help' or 'stop'."
                     className="flex-1 panel rounded-xl px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-400"/>
              <button className="px-4 py-2 rounded-xl bg-purple-600 hover:bg-purple-500 text-white text-sm font-medium">Submit</button>
              <button type="button" className="px-4 py-2 rounded-xl border border-purple-700/60 text-sm font-medium bg-purple-900/50 hover:bg-purple-800/50"
                      onClick={()=>submit("help")}>Help</button>
              <button type="button" className="px-4 py-2 rounded-xl bg-transparent hover:bg-purple-900/30 text-purple-100 text-sm font-medium"
                      onClick={()=>submit("stop")}>Stop</button>
            </form>

            {/* Feedback */}
            {message && (
              <div className="mt-4 text-purple-100/90">
                <div>{message}</div>
                {guesses.length>0 && <div className="mt-2 text-sm text-purple-200/80">Guesses so far: {guesses.join(", ")}</div>}
                {message.startsWith("Correct") && <div className="mt-1 text-xs text-purple-300/70">First try counts as correct; any prior miss scores the round incorrect.</div>}
              </div>
            )}
          </div>

          <div className="mt-6 text-xs text-purple-300/60">Keyboard: Enter=submit, digits 0–6, “help”, “stop”.</div>
        </div>
      );
    }

    // Render and surface runtime errors on the page (handy for GH Pages)
    try {
      ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
    } catch (e) {
      const er=document.getElementById("errors"); er.style.display="block"; er.textContent = String(e && e.message ? e.message : e);
    }
  </script>
</body>
</html>
